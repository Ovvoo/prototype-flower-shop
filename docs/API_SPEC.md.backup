# üîå API –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **tRPC** –¥–ª—è type-safe API. –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º.

**–ë–∞–∑–æ–≤—ã–π URL**: `/api/trpc`

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### NextAuth.js —Å–µ—Å—Å–∏–∏

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const { data: session } = useSession();

// session.user —Å–æ–¥–µ—Ä–∂–∏—Ç:
{
  id: string;
  email: string;
  name: string;
  role: 'ADMIN' | 'MANAGER' | 'CUSTOMER';
}
```

### –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

–¢—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ NextAuth.js middleware:
- `/api/trpc/orders.*` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
- `/api/trpc/admin.*` ‚Äî –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `/api/trpc/user.*` ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üì¶ Products API

### **products.list** ‚Äî –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  categoryId?: string;
  flowerTypes?: string[]; // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ü–≤–µ—Ç–æ–≤
  colors?: string[]; // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–≤–µ—Ç–∞–º
  occasions?: string[]; // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–≤–æ–¥—É
  priceFrom?: number;
  priceTo?: number;
  search?: string; // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  sortBy?: 'popularity' | 'price_asc' | 'price_desc' | 'newest';
  page?: number; // default: 1
  limit?: number; // default: 24
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  items: Product[];
  total: number;
  page: number;
  pages: number;
}

type Product = {
  id: string;
  name: string;
  slug: string;
  description: string;
  price: number;
  compareAtPrice?: number; // –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Å–∫–∏–¥–∫–∏
  images: string[];
  category: { id: string; name: string };
  stock: number;
  isFeatured: boolean;
  isNew: boolean;
  rating: number; // –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥
  reviewCount: number;
};
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
const { data } = trpc.products.list.useQuery({
  categoryId: 'cat_bouquets',
  priceFrom: 1000,
  priceTo: 5000,
  sortBy: 'popularity',
  page: 1,
  limit: 24,
});
```

---

### **products.getById** ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  id: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  id: string;
  name: string;
  slug: string;
  description: string;
  price: number;
  compareAtPrice?: number;
  images: string[];
  category: Category;

  // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
  stock: number;
  sku: string;
  weight: number;
  height: number;

  // –ê—Ç—Ä–∏–±—É—Ç—ã
  flowerTypes: string[];
  colors: string[];
  occasions: string[];

  // SEO
  metaTitle: string;
  metaDescription: string;

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  isFeatured: boolean;
  isNew: boolean;

  // –ú–µ—Ç—Ä–∏–∫–∏
  rating: number;
  reviewCount: number;
  viewsCount: number;

  // –ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã
  relatedProducts: Product[];
}
```

---

### **products.incrementViews** ‚Äî –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  productId: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  success: boolean;
}
```

---

## üõí Cart API

### **cart.add** ‚Äî –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  productId: string;
  quantity: number;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  cart: Cart;
}

type Cart = {
  items: CartItem[];
  subtotal: number;
  itemsCount: number;
};

type CartItem = {
  id: string;
  product: Product;
  quantity: number;
  subtotal: number; // product.price * quantity
};
```

---

### **cart.update** ‚Äî –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  cartItemId: string;
  quantity: number; // 0 = —É–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  cart: Cart;
}
```

---

### **cart.get** ‚Äî –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

**–ó–∞–ø—Ä–æ—Å:** (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)

**–û—Ç–≤–µ—Ç:**
```typescript
{
  cart: Cart;
}
```

---

### **cart.clear** ‚Äî –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

**–ó–∞–ø—Ä–æ—Å:** (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)

**–û—Ç–≤–µ—Ç:**
```typescript
{
  success: boolean;
}
```

---

## üì¶ Orders API

### **orders.create** ‚Äî –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  // –ö–æ–Ω—Ç–∞–∫—Ç
  customerName: string;
  customerEmail: string;
  customerPhone: string;

  // –î–æ—Å—Ç–∞–≤–∫–∞
  deliveryAddress: {
    city: string;
    street: string;
    house: string;
    apartment?: string;
    entrance?: string;
    floor?: string;
    intercom?: string;
  };
  deliveryDate: string; // ISO date
  deliveryTime: '9-12' | '12-15' | '15-18' | '18-21';
  deliveryComment?: string;

  // –ü–æ–ª—É—á–∞—Ç–µ–ª—å (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞)
  recipientName?: string;
  recipientPhone?: string;

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
  greetingCardText?: string;
  giftWrap?: 'standard' | 'premium';

  // –û–ø–ª–∞—Ç–∞
  paymentMethod: 'online' | 'cash_on_delivery';

  // –ü—Ä–æ–º–æ–∫–æ–¥
  promoCode?: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  order: {
    id: string;
    orderNumber: string; // #12345
    totalAmount: number;
    status: 'NEW';
    paymentStatus: 'PENDING' | 'PAID';
    paymentUrl?: string; // –ï—Å–ª–∏ paymentMethod = 'online'
  };
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Zod —Å—Ö–µ–º—ã)
2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. –†–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏
4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î
5. –ï—Å–ª–∏ online ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ –ÆKassa
6. –û—Ç–ø—Ä–∞–≤–∫–∞ SMS/Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

### **orders.getById** ‚Äî –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  orderId: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  id: string;
  orderNumber: string;

  // –°—É–º–º—ã
  subtotal: number;
  discount: number;
  deliveryFee: number;
  totalAmount: number;

  // –°—Ç–∞—Ç—É—Å—ã
  status: OrderStatus;
  paymentStatus: PaymentStatus;

  // –ö–æ–Ω—Ç–∞–∫—Ç
  customerName: string;
  customerEmail: string;
  customerPhone: string;

  // –î–æ—Å—Ç–∞–≤–∫–∞
  deliveryAddress: Address;
  deliveryDate: string;
  deliveryTime: string;

  // –¢–æ–≤–∞—Ä—ã
  items: OrderItem[];

  // –ò—Å—Ç–æ—Ä–∏—è
  history: OrderHistoryItem[];

  createdAt: string;
}
```

---

### **orders.list** ‚Äî –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞)

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  page?: number;
  limit?: number;
  status?: OrderStatus;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  items: Order[];
  total: number;
  page: number;
  pages: number;
}
```

---

### **orders.trackStatus** ‚Äî –û—Ç—Å–ª–µ–¥–∏—Ç—å —Å—Ç–∞—Ç—É—Å

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  orderNumber: string; // #12345
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  orderNumber: string;
  status: OrderStatus;
  statusLabel: string; // "–ó–∞–∫–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è"
  estimatedDelivery: string; // "–°–µ–≥–æ–¥–Ω—è, 15:00-18:00"
  timeline: {
    step: string;
    label: string;
    completedAt?: string;
    isActive: boolean;
  }[];
}

// –ü—Ä–∏–º–µ—Ä timeline:
[
  { step: 'NEW', label: '–ó–∞–∫–∞–∑ –ø–æ–ª—É—á–µ–Ω', completedAt: '2026-01-27T10:00:00Z', isActive: false },
  { step: 'CONFIRMED', label: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω', completedAt: '2026-01-27T10:30:00Z', isActive: false },
  { step: 'PROCESSING', label: '–°–æ–±–∏—Ä–∞–µ—Ç—Å—è', completedAt: null, isActive: true },
  { step: 'SHIPPED', label: '–í –¥–æ—Å—Ç–∞–≤–∫–µ', completedAt: null, isActive: false },
  { step: 'DELIVERED', label: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω', completedAt: null, isActive: false },
]
```

---

## üîë User API

### **user.register** ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  email: string;
  password: string; // –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
  name: string;
  phone?: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  user: {
    id: string;
    email: string;
    name: string;
  };
  session: Session;
}
```

---

### **user.login** ‚Äî –í—Ö–æ–¥

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è NextAuth.js:
```typescript
import { signIn } from 'next-auth/react';

await signIn('credentials', {
  email: 'user@example.com',
  password: 'password',
  redirect: false,
});
```

---

### **user.getProfile** ‚Äî –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

**–ó–∞–ø—Ä–æ—Å:** (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –±–µ—Ä—ë—Ç –∏–∑ —Å–µ—Å—Å–∏–∏)

**–û—Ç–≤–µ—Ç:**
```typescript
{
  id: string;
  email: string;
  name: string;
  phone: string;
  birthDate?: string;
  role: 'CUSTOMER' | 'ADMIN' | 'MANAGER';
  createdAt: string;

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  orderCount: number;
  totalSpent: number;
}
```

---

### **user.updateProfile** ‚Äî –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  name?: string;
  phone?: string;
  birthDate?: string; // ISO date
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  user: User;
}
```

---

### **user.changePassword** ‚Äî –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  currentPassword: string;
  newPassword: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  success: boolean;
}
```

---

## üìç Addresses API

### **addresses.list** ‚Äî –°–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤

**–ó–∞–ø—Ä–æ—Å:** (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)

**–û—Ç–≤–µ—Ç:**
```typescript
{
  addresses: Address[];
}

type Address = {
  id: string;
  label: string; // "–î–æ–º", "–†–∞–±–æ—Ç–∞"
  city: string;
  street: string;
  house: string;
  apartment?: string;
  entrance?: string;
  floor?: string;
  intercom?: string;
  isDefault: boolean;
};
```

---

### **addresses.create** ‚Äî –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  label: string;
  city: string;
  street: string;
  house: string;
  apartment?: string;
  entrance?: string;
  floor?: string;
  intercom?: string;
  isDefault?: boolean;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  address: Address;
}
```

---

### **addresses.update** ‚Äî –û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  addressId: string;
  data: {
    label?: string;
    city?: string;
    street?: string;
    house?: string;
    apartment?: string;
    entrance?: string;
    floor?: string;
    intercom?: string;
    isDefault?: boolean;
  };
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  address: Address;
}
```

---

### **addresses.delete** ‚Äî –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  addressId: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  success: boolean;
}
```

---

## ‚≠ê Reviews API

### **reviews.list** ‚Äî –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  productId?: string; // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–æ–≤–∞—Ä—É
  rating?: number; // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (1-5)
  page?: number;
  limit?: number;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  items: Review[];
  total: number;
  averageRating: number;
  ratingDistribution: {
    1: number; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤ —Å 1 –∑–≤–µ–∑–¥–æ–π
    2: number;
    3: number;
    4: number;
    5: number;
  };
}

type Review = {
  id: string;
  user: {
    name: string;
    avatarUrl?: string;
  };
  rating: number;
  title: string;
  comment: string;
  images: string[];
  createdAt: string;

  // –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏
  adminReply?: {
    text: string;
    repliedAt: string;
  };

  // –ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å
  helpfulCount: number;
  unhelpfulCount: number;
};
```

---

### **reviews.create** ‚Äî –°–æ–∑–¥–∞—Ç—å –æ—Ç–∑—ã–≤

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  productId: string;
  orderId?: string; // –ï—Å–ª–∏ –æ—Ç–∑—ã–≤ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
  rating: number; // 1-5
  title: string;
  comment: string;
  images?: string[]; // URLs –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  review: Review;
  message: "–û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é";
}
```

---

### **reviews.markHelpful** ‚Äî –û—Ç–º–µ—Ç–∏—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  reviewId: string;
  helpful: boolean; // true = helpful, false = unhelpful
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  success: boolean;
}
```

---

## üéüÔ∏è Promo Codes API

### **promoCodes.validate** ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  code: string;
  cartTotal: number; // –°—É–º–º–∞ –∫–æ—Ä–∑–∏–Ω—ã (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ min_order_amount)
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  valid: boolean;
  promoCode?: {
    code: string;
    discountType: 'PERCENTAGE' | 'FIXED_AMOUNT';
    discountValue: number;
    calculatedDiscount: number; // –°–∫–æ–ª—å–∫–æ —Å–∫–∏–¥–∫–∞ –≤ —Ä—É–±–ª—è—Ö
  };
  error?: string; // –ï—Å–ª–∏ !valid
}

// –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫:
"–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω"
"–ü—Ä–æ–º–æ–∫–æ–¥ –∏—Å—Ç—ë–∫"
"–ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑"
"–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞: 3000‚ÇΩ"
```

---

## üìä Analytics API (–¥–ª—è –∞–¥–º–∏–Ω–∞)

### **analytics.dashboard** ‚Äî –î–∞—à–±–æ—Ä–¥ –º–µ—Ç—Ä–∏–∫–∏

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  period: 'today' | 'week' | 'month' | 'year';
  compareWith?: 'previous_period'; // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  revenue: {
    current: number;
    previous?: number;
    change?: number; // +15% –∏–ª–∏ -10%
  };
  orderCount: {
    current: number;
    previous?: number;
    change?: number;
  };
  averageOrderValue: {
    current: number;
    previous?: number;
    change?: number;
  };
  conversionRate: {
    current: number; // –ü—Ä–æ—Ü–µ–Ω—Ç
    previous?: number;
    change?: number;
  };

  // –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂ (–ø–æ –¥–Ω—è–º/–Ω–µ–¥–µ–ª—è–º/–º–µ—Å—è—Ü–∞–º)
  salesChart: {
    labels: string[]; // –î–∞—Ç—ã
    values: number[]; // –í—ã—Ä—É—á–∫–∞
  };

  // –¢–æ–ø-10 —Ç–æ–≤–∞—Ä–æ–≤
  topProducts: {
    productId: string;
    name: string;
    revenue: number;
    salesCount: number;
  }[];
}
```

---

## üîê Admin API

### **admin.orders.list** ‚Äî –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (–∞–¥–º–∏–Ω)

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  status?: OrderStatus;
  paymentStatus?: PaymentStatus;
  dateFrom?: string; // ISO date
  dateTo?: string;
  search?: string; // –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É
  page?: number;
  limit?: number;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  items: Order[];
  total: number;
  page: number;
  pages: number;
}
```

---

### **admin.orders.updateStatus** ‚Äî –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  orderId: string;
  newStatus: OrderStatus;
  comment?: string; // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  order: Order;
  message: "–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω, –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ";
}
```

---

### **admin.products.create** ‚Äî –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  name: string;
  slug: string;
  description: string;
  price: number;
  compareAtPrice?: number;
  categoryId: string;
  images: string[];
  stock: number;
  sku: string;
  weight?: number;
  height?: number;
  flowerTypes?: string[];
  colors?: string[];
  occasions?: string[];
  metaTitle?: string;
  metaDescription?: string;
  isFeatured?: boolean;
  isNew?: boolean;
  isActive?: boolean;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  product: Product;
}
```

---

### **admin.products.update** ‚Äî –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  productId: string;
  data: {
    // –õ—é–±—ã–µ –ø–æ–ª—è –∏–∑ create (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
  };
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  product: Product;
}
```

---

### **admin.products.delete** ‚Äî –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä

**–ó–∞–ø—Ä–æ—Å:**
```typescript
{
  productId: string;
}
```

**–û—Ç–≤–µ—Ç:**
```typescript
{
  success: boolean;
}
```

---

## üåê Webhooks

### **–ÆKassa webhook** ‚Äî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–ª–∞—Ç–µ–∂–µ

**Endpoint**: `POST /api/webhooks/yukassa`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "type": "notification",
  "event": "payment.succeeded" | "payment.canceled" | "refund.succeeded",
  "object": {
    "id": "payment_id",
    "status": "succeeded",
    "amount": {
      "value": "3500.00",
      "currency": "RUB"
    },
    "metadata": {
      "order_id": "order_123"
    }
  }
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
1. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ (HMAC SHA256)
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞:
   - `payment.succeeded` ‚Üí `paymentStatus = 'PAID'`, `status = 'CONFIRMED'`
   - `payment.canceled` ‚Üí `paymentStatus = 'FAILED'`
3. –û—Ç–ø—Ä–∞–≤–∫–∞ SMS/Email –∫–ª–∏–µ–Ω—Ç—É
4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `order_history`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true
}
```

---

## üîí Rate Limiting

### –õ–∏–º–∏—Ç—ã –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º:

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –õ–∏–º–∏—Ç | –ü–µ—Ä–∏–æ–¥ |
|----------|-------|--------|
| `user.register` | 5 –ø–æ–ø—ã—Ç–æ–∫ | 15 –º–∏–Ω—É—Ç |
| `user.login` | 5 –ø–æ–ø—ã—Ç–æ–∫ | 15 –º–∏–Ω—É—Ç |
| `orders.create` | 10 –∑–∞–∫–∞–∑–æ–≤ | 1 —á–∞—Å |
| `reviews.create` | 5 –æ—Ç–∑—ã–≤–æ–≤ | 1 –¥–µ–Ω—å |
| –û—Å—Ç–∞–ª—å–Ω—ã–µ | 100 –∑–∞–ø—Ä–æ—Å–æ–≤ | 1 –º–∏–Ω—É—Ç–∞ |

### –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:

```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1706362800
```

---

## ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏:

```typescript
{
  error: {
    code: string; // "VALIDATION_ERROR", "NOT_FOUND", "UNAUTHORIZED"
    message: string; // –ß–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    details?: any; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Zod –æ—à–∏–±–∫–∏)
  };
}
```

### HTTP —Å—Ç–∞—Ç—É—Å—ã:

- `200` ‚Äî –£—Å–ø–µ—Ö
- `400` ‚Äî –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `401` ‚Äî –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` ‚Äî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω
- `404` ‚Äî –ù–µ –Ω–∞–π–¥–µ–Ω–æ
- `429` ‚Äî –ü—Ä–µ–≤—ã—à–µ–Ω rate limit
- `500` ‚Äî –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (tRPC)

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (React)

```typescript
import { trpc } from '@/lib/trpc';

function ProductList() {
  // Query
  const { data, isLoading, error } = trpc.products.list.useQuery({
    categoryId: 'cat_bouquets',
    page: 1,
    limit: 24,
  });

  // Mutation
  const addToCart = trpc.cart.add.useMutation({
    onSuccess: () => {
      toast.success('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');
    },
    onError: (error) => {
      toast.error(error.message);
    },
  });

  const handleAddToCart = (productId: string) => {
    addToCart.mutate({ productId, quantity: 1 });
  };

  if (isLoading) return <Skeleton />;
  if (error) return <Error message={error.message} />;

  return (
    <div>
      {data.items.map((product) => (
        <ProductCard
          key={product.id}
          product={product}
          onAddToCart={() => handleAddToCart(product.id)}
        />
      ))}
    </div>
  );
}
```

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (tRPC Router)

```typescript
import { router, publicProcedure } from '@/server/trpc';
import * as z from 'zod';

export const productsRouter = router({
  list: publicProcedure
    .input(
      z.object({
        categoryId: z.string().optional(),
        priceFrom: z.number().optional(),
        priceTo: z.number().optional(),
        page: z.number().default(1),
        limit: z.number().default(24),
      })
    )
    .query(async ({ input, ctx }) => {
      const { categoryId, priceFrom, priceTo, page, limit } = input;

      const where = {
        ...(categoryId && { categoryId }),
        ...(priceFrom && { price: { gte: priceFrom } }),
        ...(priceTo && { price: { lte: priceTo } }),
        isActive: true,
      };

      const [items, total] = await Promise.all([
        ctx.prisma.product.findMany({
          where,
          skip: (page - 1) * limit,
          take: limit,
          include: {
            category: true,
          },
        }),
        ctx.prisma.product.count({ where }),
      ]);

      return {
        items,
        total,
        page,
        pages: Math.ceil(total / limit),
      };
    }),

  add: publicProcedure
    .input(
      z.object({
        productId: z.string(),
        quantity: z.number().min(1),
      })
    )
    .mutation(async ({ input, ctx }) => {
      // –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
      // ...
    }),
});
```

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏
**–í–µ—Ä—Å–∏—è**: 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –Ø–Ω–≤–∞—Ä—å 2026
