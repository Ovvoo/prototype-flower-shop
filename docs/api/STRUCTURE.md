# Структура документации API

## 📚 Полная иерархия

```
docs/api/
│
├── 📄 README.md
│   └─ Таблица содержания и краткое описание
│
├── 🗺️ NAVIGATION.md  ⭐ НАЧНИ ОТСЮДА
│   └─ Быстрая навигация, примеры по задачам, матрица авторизации
│
├── 📋 STRUCTURE.md (этот файл)
│   └─ Обзор организации документации
│
├── ═════════════════════════════════════════════
│
├── 🔵 API_INDEX.md (200 строк) — ОБЗОР
│   ├─ Что такое tRPC
│   ├─ Аутентификация (NextAuth.js)
│   ├─ Rate Limiting (лимиты по эндпоинтам)
│   ├─ Обработка ошибок (формат, HTTP коды)
│   └─ Базовые примеры (Query + Mutation)
│
├── ═════════════════════════════════════════════
│
├── 🟢 ПУБЛИЧНЫЕ API (без авторизации)
│   │
│   ├── 📦 API_PRODUCTS.md (200 строк)
│   │   ├─ products.list — Фильтрация, поиск, пагинация
│   │   ├─ products.getById — Детали + похожие товары
│   │   └─ products.incrementViews — Счётчик просмотров
│   │
│   └── 🛒 API_CART.md (186 строк)
│       ├─ cart.add — Добавить товар
│       ├─ cart.update — Изменить количество
│       ├─ cart.get — Получить корзину
│       └─ cart.clear — Очистить корзину
│
├── ═════════════════════════════════════════════
│
├── 🔐 ПРИВАТНЫЕ API (требуют логина)
│   │
│   ├── 📦 API_ORDERS.md (276 строк)
│   │   ├─ orders.create — Создать заказ
│   │   ├─ orders.getById — Детали заказа
│   │   ├─ orders.list — Мои заказы
│   │   └─ orders.trackStatus — Отследить доставку
│   │
│   ├── 🔑 API_USER.md (318 строк)
│   │   ├─ user.register — Регистрация
│   │   ├─ user.login — Вход
│   │   ├─ user.getProfile — Мой профиль
│   │   ├─ user.updateProfile — Обновить профиль
│   │   ├─ user.changePassword — Сменить пароль
│   │   ├─ addresses.list — Мои адреса
│   │   ├─ addresses.create — Сохранить адрес
│   │   ├─ addresses.update — Изменить адрес
│   │   └─ addresses.delete — Удалить адрес
│   │
│   └── ⭐ API_REVIEWS.md (238 строк)
│       ├─ reviews.list — Отзывы на товар
│       ├─ reviews.create — Оставить отзыв
│       └─ reviews.markHelpful — Отметить полезным
│
├── ═════════════════════════════════════════════
│
├── 🎟️ КОММЕРЧЕСКИЕ API
│   │
│   └── 💰 API_PROMO.md (194 строк)
│       └─ promoCodes.validate — Валидация промокода
│
├── ═════════════════════════════════════════════
│
├── 🔒 АДМИНСКИЕ API (требуют ADMIN/MANAGER роль)
│   │
│   └── 🔐 API_ADMIN.md (339 строк)
│       ├─ analytics.dashboard — Статистика и графики
│       ├─ admin.orders.list — Все заказы
│       ├─ admin.orders.updateStatus — Изменить статус
│       ├─ admin.products.create — Создать товар
│       ├─ admin.products.update — Изменить товар
│       └─ admin.products.delete — Удалить товар
│
├── ═════════════════════════════════════════════
│
└── 🌐 СИСТЕМНЫЕ API
    │
    └── 🪝 API_WEBHOOKS.md (237 строк)
        └─ POST /api/webhooks/yukassa — Webhook ЮKassa
```

---

## 📊 Статистика

| Метрика | Значение |
|---------|----------|
| Всего файлов | 11 |
| Всего строк | 2,276 |
| Всего размер | 76 KB |
| Среднее на файл | 200+ строк |
| Макс размер файла | 339 строк (API_ADMIN.md) |
| Мин размер файла | 186 строк (API_CART.md) |

---

## 🎯 Назначение каждого файла

### 1. **README.md** (96 строк)
Навигация и структура всей документации. Таблица содержания.

### 2. **NAVIGATION.md** (200+ строк) ⭐
**НАЧНИ ОТСЮДА ЕСЛИ НОВИЧОК**
- Быстрая навигация по API
- Примеры по жизненным сценариям
- Матрица авторизации (кто может вызывать что)

### 3. **STRUCTURE.md** (этот файл)
Обзор организации документации, статистика.

### 4. **API_INDEX.md** (197 строк)
Основа для понимания:
- Что такое tRPC
- Как работает аутентификация
- Rate Limiting (лимиты на вызовы)
- Обработка ошибок
- Базовые примеры

### 5-10. **API_*.md** (186-339 строк каждый)
Специфичные группы эндпоинтов:
- API_PRODUCTS.md — товары
- API_CART.md — корзина
- API_ORDERS.md — заказы
- API_USER.md — пользователь и адреса
- API_REVIEWS.md — отзывы
- API_PROMO.md — промокоды
- API_ADMIN.md — админ панель
- API_WEBHOOKS.md — платежи

---

## 🔄 Как использовать

### Сценарий 1: "Я новичок в проекте"
```
1. Читай docs/api/NAVIGATION.md
2. Выбери интересующий API
3. Прочитай соответствующий файл (например, API_PRODUCTS.md)
4. Копируй пример кода
```

### Сценарий 2: "Мне нужно реализовать каталог"
```
1. NAVIGATION.md → раздел Products
2. API_PRODUCTS.md → products.list
3. Скопировать пример кода
4. Адаптировать под свой фронтенд
```

### Сценарий 3: "Я работаю над checkout'ом"
```
1. NAVIGATION.md → примеры по задачам → "Оформить заказ"
2. API_ORDERS.md → orders.create
3. API_PROMO.md → promoCodes.validate (если нужны промокоды)
4. API_USER.md → addresses.* (если нужны адреса)
```

### Сценарий 4: "Мне нужна админ панель"
```
1. NAVIGATION.md → матрица авторизации → ADMIN
2. API_ADMIN.md → выбрать нужный эндпоинт
3. API_INDEX.md → как работает tRPC (если вопросы)
```

---

## 🔗 Перекрёстные ссылки

Внутри документации используется @-синтаксис:
```
@API_INDEX.md          — обзор API
@API_PRODUCTS.md       — получение товаров
@NAVIGATION.md         — быстрая навигация
@docs/DATABASE_SCHEMA.md — схема БД
```

---

## ✅ Гарантии качества

- ✅ Каждый файл < 350 строк (легко читается)
- ✅ Полные примеры кода (client + server)
- ✅ Типизация на TypeScript
- ✅ Все эндпоинты документированы
- ✅ Структура запроса/ответа для каждого
- ✅ Матрица авторизации понятна
- ✅ Rate Limiting логика прозрачна
- ✅ Обработка ошибок объяснена

---

## 🔐 Безопасность и авторизация

Матрица в NAVIGATION.md показывает:
- ✅ какой API требует авторизацию
- ✅ какие роли (ADMIN, MANAGER, CUSTOMER) имеют доступ
- ✅ какие API полностью публичные

---

## 📝 Поддержание документации

При изменении API:
1. Обнови соответствующий файл в docs/api/
2. Обнови NAVIGATION.md если изменилась матрица авторизации
3. Проверь что файл остаётся < 350 строк
4. Добавь примеры кода если нужно

---

**Статус**: ✅ Структура документации готова
**Версия**: 2.0 (Модульная)
**Дата обновления**: 2026-01-28
